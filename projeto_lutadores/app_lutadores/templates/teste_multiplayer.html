{% extends "base.html" %}
{% block content %}
<div>
  <h2>Room: {{ room_name }}</h2>
  <div id="messages" style="background-color:#ffffff; color:#000000; border:1px solid #ccc; height:300px; overflow-y:auto; padding:5px;">
    <!-- mensagens -->
  </div>
  <input id="messageInput" type="text" placeholder="Mensagem" style="color:#000000; background-color:#ffffff;"/>
  <button id="sendBtn">Enviar</button>
</div>
<script>
(function(){
  const roomName = "sala1";
  const proto = location.protocol === "https:" ? "wss" : "ws";
  const ws = new WebSocket(`${proto}://${location.host}/ws/teste/${roomName}/`);
  const messagesDiv = document.getElementById("messages");
  const input = document.getElementById("messageInput");
  const sendBtn = document.getElementById("sendBtn");

  ws.onmessage = e => {
    const msg = JSON.parse(e.data).message;
    const p = document.createElement("p");
    p.textContent = msg;
    p.style.margin = "2px 0";
    messagesDiv.appendChild(p);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  };

  sendBtn.addEventListener("click", ()=>{
    const text = input.value.trim();
    if(text) {
      ws.send(JSON.stringify({ message: text }));
      input.value = "";
    }
  });
  input.addEventListener("keyup", e=>{
    if(e.key === "Enter") sendBtn.click();
  });
})();
</script>
{% endblock %}
